<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
        <title>Hjem | InMarket App</title>
        <link rel="stylesheet" href="css/w3pro.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="fontawesome-free-5.1.0-web/css/all.css">
        <link rel="manifest" href="/manifest.json">
        <meta name="theme-color" content="#ffffff">
    </head>
    <body>
        <div class="w3-bar w3-top bottom-accent bar bg-white">
            <a href="#" class="w3-bar-item"><img src="img/logos/logo-flat-small.png" height="48px" alt="" id="navbar-img"></a>
            <span class="header-text w3-large common-line-height-bar" id="currentPageHeader">InMarket</span>
            <div class=" w3-right" id="hidden-items-top">
                <a href="#/meldinger" class="w3-large common-line-height-bar"> <i class="far fa-envelope"></i> </a>
                <a href="#" class="w3-large common-line-height-bar"><i class="fas fa-search"></i></a>
                <a href="javascript:void(0);" class="" onclick="sidebarToggle()"> <img src="img/stock-profile.jpg" alt="" class="w3-circle" height="48px"> </a>
            </div>
        </div>
        <div class="w3-sidebar w3-animate-right w3-hide w3-bar-block w3-card" id="sidebar" style="right:0;">
            <button type="button" name="closeSidebar" class="w3-bar-item w3-button w3-mobile sidebar-button">Lukk<span class="w3-right">&times</span></button>
            <a href="#/instillinger" class="w3-bar-item w3-button w3-mobile sidebar-button">Instillinger</a>
            <a href="#/meg" class="w3-bar-item w3-button w3-mobile sidebar-button">Min profil</a>
            <a href="#/kontrollpanel" class="w3-bar-item w3-button w3-mobile sidebar-button w3-hide" id="controlpanelLink">Kontrollpanel</a>
        </div>
        <nav class="w3-bar w3-bottom w3-center top-accent w3-tiny bg-white" id="bottomNav">
            <a href="#/hjem" class="w3-button" id="startButton">Startside</a>
            <a href="#/videoer" class="w3-button" id="videoButton">Bedriftsvideoer</a>
            <a href="#/eventer" class="w3-button" id="eventButton">Eventer</a>
            <a href="#/grupper" class="w3-button" id="groupButton">Grupper</a>
            <a href="#/kontakt" class="w3-button" id="contactButton">Kontakt</a>
        </nav>

        <section class="w3-content w3-container w3-padding-64" id="content">
        </section>
    </body>
    <script src="js/jquery-3.3.1.js" charset="utf-8"></script>
    <script src="js/patternjs/pattern.js" charset="utf-8"></script>
    <script src="js/router.js" charset="utf-8"></script>
    <script src="js/bedrift.js" charset="utf-8"></script>
    <script src="js/contact.js" charset="utf-8"></script>
    <script src="js/conversation.js" charset="utf-8"></script>
    <script src="js/controlpanel.js" charset="utf-8"></script>
    <script src="js/events.js" charset="utf-8"></script>
    <script src="js/group.js" charset="utf-8"></script>
    <script src="js/groups.js" charset="utf-8"></script>
    <script src="js/home.js" charset="utf-8"></script>
    <script src="js/login.js" charset="utf-8"></script>
    <script src="js/messages.js" charset="utf-8"></script>
    <script src="js/myProfile.js" charset="utf-8"></script>
    <script src="js/profile.js" charset="utf-8"></script>
    <script src="js/register.js" charset="utf-8"></script>
    <script src="js/settings.js" charset="utf-8"></script>
    <script type="text/javascript">
        let sidebar = document.getElementById("sidebar");
        let bottomNav = document.getElementById("bottomNav");
        let hiddenItems = document.getElementById("hidden-items-top");

        const getHTML = (url) => {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: url,
                    success: function (htmlContent) {
                        resolve(htmlContent)
                    },
                    error: function () {
                        reject("error")
                    }
                });
            });
        };

        (function () {
            let iterations = [];
            Object.keys(Router.routes).forEach((page,index) => {
                let html = getHTML(Router.routes[page].url)
                    .then((result) => {
                        Router.routes[page].html = result;
                    }
                );

                iterations.push(html);
            });

            return Promise.all(iterations).then(() => {
                Router.route()
                interfaceController();
            });
        })();


        window.onhashchange = function () {
            Router.route();
            interfaceController();
        };

        window.onload = function () {
            if (localStorage.adminLevel > 0) {
                document.getElementById("controlpanelLink").classList.remove("w3-hide");
            }
        }

        function interfaceController() {
            let page = Router.getParameters()[1];
            switch (page) {
                case "registrering":
                    bottomNav.classList.add("w3-hide");
                    hiddenItems.classList.add("w3-hide");
                    break;
                case "innlogging":
                    bottomNav.classList.add("w3-hide");
                    hiddenItems.classList.add("w3-hide");
                    break;
                case "bedrift":
                    bottomNav.classList.add("w3-hide");
                    hiddenItems.classList.remove("w3-hide");
                    break;
                case "samtale":
                    bottomNav.classList.add("w3-hide");
                    hiddenItems.classList.remove("w3-hide");
                    break;
                case "instillinger":
                    bottomNav.classList.add("w3-hide");
                    hiddenItems.classList.remove("w3-hide");
                    break;
                default:
                    bottomNav.classList.remove("w3-hide");
                    hiddenItems.classList.remove("w3-hide");
                    break;
            }
        }

        function sidebarToggle() {
            sidebar.classList.toggle("w3-hide")
        }

        $("#sidebar").click(function () {
            sidebarToggle();
        });
    </script>

</html>
